# Text Snippetter
ユーザーがテキストやコードスニペットを共有できるWEBアプリケーションです。

## URL

## Demo

## 概要
Text Snippetterはユーザーアカウントを作成せずに、簡単にテキストやスニペットを共有できるWEBアプリケーションです。  
テキストに使用しているプラグラミング言語を選択すると、シンタックスハイライトされた状態のテキストを共有できます。  
また、テキストの有効期限を決めることができ、期限が過ぎたスニペットは自動的に削除されます。  

### 使い方
1. エディタに共有したいテキストを貼り付けます
2. 「Syntax Highlight」のドロップダウンでテキストで使用している言語を選択します
3. 「Text Expiration」のドロップダウンでスニペットの有効期限を選択します
4. 「Create Snippet」ボタンを押すと、共有用の一意のURLに遷移します
5. このURLを通じて自分が作成したスニペットを他の人と共有します

## 作成の経緯
以下の知識・技術を活用した動的なWEBアプリケーションを作成して、サーバーサイドのスキル向上を目指しました。

- マイグレーションベースのスキーマ管理
- バックエンドからのデータベース操作
- SQLインジェクション対策
- サーバーサイドレンダリング
- 3層アーキテクチャ


## 使用技術
- フロントエンド
  - 使用言語： HTML, CSS, Javascript
  - コードエディタ: Monaco Editor
  - CSSフレームワーク: chota, Flexbox Grid

- バックエンド
  - 使用言語： PHP
  - データベース： MySQL
  - Webサーバー: NGINX
  - サーバー: Amazon EC2
  - SSL/TLS証明書更新: Certbot

## 期間
2023年11月10日から6日間かけて開発しました。

## こだわった点
### マイグレーションベースのスキーマ管理
データベーススキーマの管理は細かい変更にも対応できるように、マイグレーションベースの管理を採用しました。  
このために```code-gen```, ```migrate```という独自のコマンドを使用してスキーマ定義に関するファイルを生成し、マイグレーションの実行しています。  

以下はマイグレーションの手順の概要です。

1. ```php console migrate --init```コマンドを実行すると、マイグレーションのバージョン管理を行うためのmigrationsテーブルが生成されます。
2. ```php console code-gen migration --name {classname}```コマンドを実行すると、スキーマ定義を行うためのファイルが生成されます。このファイルは ```{YYYY-MM-DD}_{UNIX_TIMESTAMP}_{classname}.php```という命名規則に従います。
3. 作成されたファイルに、スキーマ定義を記述します。
4. ```php console migrate```コマンドを実行すると、スキーマ定義をしたファイルが実行されて、新しいスキーマがデータベースに反映されます。  

さらに、変更の取り消しも容易に行えるように、ロールバックの機能も実装しました。  
例えば```php console migrate --rollback 1```を実行すると、直前の1つのマイグレーションを取り消すことができます。  

### データのバリデーション
ユーザーから受け取るデータについては、厳格な検証とサニタイズを行った上で、データベースへの保存を行っています。
具体的な例として、バックエンドに送信されるスニペットに対しては、以下の条件を検証するバリデーション関数が適用されます。これらの条件に一致する場合、データはデータベースに保存されず、クライアント側にアラートが表示されます。

- 空白のみの場合
- Unicode文字以外を使用している場合
- 文字数がデータベースのTEXT型の上限を越している場合

なお、INSERT INTOステートメントを実行する際には、プリペアドステートメントを使用しています。これにより、SQLインジェクションを防止し、セキュリティを確保しています。

### MVCアーキテクチャの実装
開発の拡張性、保守性を高めるためにMVCアーキテクチャを採用しました。  
データベースがモデル、レンダリング用のインスタンス(HTMLRender)がビュー、ルーティング(routes.php)のコールバックがコントローラです。  

以下の流れでリクエストを受け取り、サーバーサイドレンダリングを実現しています。
1. エントリーポイント(index.php)で取得したURLを解析して、取得したパスがルーティングに存在するか確認します
2. ルーティングでは受け取った文字列に応じて、コールバック関数を返します。このコールバック関数内で、データベースからデータを取得し、そのデータをもとにレンダリング用のインスタンスを作成します
3. レンダリング用のインスタンスのメソッドを実行してHTMLをレンダリングします

新しいパスを追加したい場合は、ルーティングに文字列と、それに紐づいたコールバック関数を追記するだけで良いので簡単に拡張ができます。また、モデルとビューが完全に分離されているので、今後機能が増えた場合でも高い保守性を維持できます。

## これからの改善点、拡張案
### 有効期限の詳細設定
スニペットの有効期限は10分後や1時間後などシンプルな設計にしました。日付や時間などより詳細な有効期限を設定できるようにするのも面白いかなと思いました。

### ユーザーアカウントの作成
- 作成した後のスニペットを自身で削除できるようにする
- 共有する相手をメールアドレスで制限する
- パスワード付きでスニペットを制限する
など追加できる機能が増えるため、アカウントを作成して利用できるようにするのも良いかもなと思いました。
